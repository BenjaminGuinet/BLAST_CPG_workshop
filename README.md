---
title: "BLAST Search with MMseqs2"
author: "Your Name"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

This workshop will introduce **MMseqs2**, a fast alternative to BLAST for sequence similarity searches.

### Objectives:
- Install MMseqs2
- Create a sequence database
- Run a sequence search
- Interpret the results

## Installation

MMseqs2 is already installed on Dardel. 

```
module load bioinfo-tools
module load MMseqs2/15-6f452
module load MMseqs2_data/latest
```

## Creating a Sequence Database

Before searching, either you can choose any of the pre-build databases from Dardel : 

```
module help MMseqs2_data/latest
```
The list of databases available with 'mmseqs databases' with their local UPPMAX locations, if available:

| Local UPPMAX location            | Name                  | Type       | Taxonomy | URL |
|----------------------------------|----------------------|-----------|---------|-------------------------------------------------------------|
| $MMSEQS2_DATA/UniRef100          | UniRef100            | Aminoacid  | true    | [UniRef100](https://www.uniprot.org/help/uniref)            |
| $MMSEQS2_DATA/UniRef90           | UniRef90             | Aminoacid  | true    | [UniRef90](https://www.uniprot.org/help/uniref)             |
| $MMSEQS2_DATA/UniRef50           | UniRef50             | Aminoacid  | true    | [UniRef50](https://www.uniprot.org/help/uniref)             |
| $MMSEQS2_DATA/UniProtKB          | UniProtKB            | Aminoacid  | true    | [UniProtKB](https://www.uniprot.org/help/uniprotkb)         |
| $MMSEQS2_DATA/UniProtKB_TrEMBL   | UniProtKB/TrEMBL     | Aminoacid  | true    | [UniProtKB TrEMBL](https://www.uniprot.org/help/uniprotkb)  |
| $MMSEQS2_DATA/UniProtKB_Swiss-Prot | UniProtKB/Swiss-Prot | Aminoacid  | true    | [Swiss-Prot](https://uniprot.org)                           |
| $MMSEQS2_DATA/NR                 | NR                   | Aminoacid  | true    | [NR](https://ftp.ncbi.nlm.nih.gov/blast/db/FASTA)          |
| $MMSEQS2_DATA/NT                 | NT                   | Nucleotide | false   | [NT](https://ftp.ncbi.nlm.nih.gov/blast/db/FASTA)          |
| $MMSEQS2_DATA/GTDB               | GTDB                 | Aminoacid  | true    | [GTDB](https://gtdb.ecogenomic.org)                         |
| $MMSEQS2_DATA/PDB                | PDB                  | Aminoacid  | false   | [PDB](https://www.rcsb.org)                                  |
| $MMSEQS2_DATA/PDB70              | PDB70                | Profile    | false   | [PDB70](https://github.com/soedinglab/hh-suite)            |
| $MMSEQS2_DATA/Pfam-A.full        | Pfam-A.full          | Profile    | false   | [Pfam-A.full](https://pfam.xfam.org)                        |
| $MMSEQS2_DATA/Pfam-A.seed        | Pfam-A.seed          | Profile    | false   | [Pfam-A.seed](https://pfam.xfam.org)                        |
| $MMSEQS2_DATA/Pfam-B             | Pfam-B               | Profile    | false   | [Pfam-B](https://xfam.wordpress.com/2020/06/30/a-new-pfam-b-is-released) |
| $MMSEQS2_DATA/CDD                | CDD                  | Profile    | false   | [CDD](https://www.ncbi.nlm.nih.gov/Structure/cdd/cdd.shtml) |
| $MMSEQS2_DATA/eggNOG             | eggNOG               | Profile    | false   | [eggNOG](http://eggnog5.embl.de)                            |
| $MMSEQS2_DATA/VOGDB              | VOGDB                | Profile    | false   | [VOGDB](https://vogdb.org)                                  |
| $MMSEQS2_DATA/dbCAN2             | dbCAN2               | Profile    | false   | [dbCAN2](http://bcb.unl.edu/dbCAN2)                         |
| $MMSEQS2_DATA/SILVA              | SILVA                | Nucleotide | true    | [SILVA](https://www.arb-silva.de)                           |
| $MMSEQS2_DATA/Resfinder          | Resfinder            | Nucleotide | false   | [Resfinder](https://cge.cbs.dtu.dk/services/ResFinder)      |
| $MMSEQS2_DATA/Kalamari           | Kalamari             | Nucleotide | true    | [Kalamari](https://github.com/lskatz/Kalamari)             |





>CcFV2_orf001 [DNA_POLYMERASE_DNAPOL]
ATGGTGAACGATACTACCATTTTCGAATCGTATCGTTATCAACAATTTATTAATGAATTTATATATAAATGTAATAATACTAATGGAGGATCTTCTAAAGAACTAAAAAGTAATGGGGATATTATTGACAATCAACACCAGCAACAACAATATGGCACTGAAGATAAAATAACAATTACGTCTTCGATTGGTAATGAAACTGAATATTCATCAGATGGTAATTATACAAAAAATTGTAATCTTTTATGGTTATTGGCGATTGAAGAATCGGAAATATCATATAATTTTTGTGGGCTTGATTTAAAAACATTTACAACTACAAGTATTTCAAGTTCATATAAACCTTCAATAATTTGTGCAATAAGTGAAAATTATTGGGCTGATTTATCCTTATTATTATATGATTCTTATCCATATGCAATATCTAGTATAAAATTTACGGATTTATATGTTACAATTCATGCGTCTCCTTTATTAGACGTTATCTTTAATGTGAATCATTGTGAAAAAGAATATTGTTATCCGCTTGTCATAATTGAATGTACAAGCTTAATATCGCGTAATATAGTATTAAAATTTTTAGAGGATAATAAAGTACGGCGTAATTTCTTTTATTTATCCGCTAATCAAAGTCCACATTTTATAGTTATGATTTATACATTAATAGAGCATTATATAATACGAGTTGAAAGTTTACAAAAAATCAATAATAAACGACAATATAATCATGTAATTTTGAATGCCGAGCGTTTAATTATTGATAAAATCTCAATGTTAAAACAATTGAGTGTTATGGATAATCCGGATAATCAAGAATTGTGCATAGATAATATATTTACACCAAACGGCTTATATTCAATTAATTCAGGGCACTTGCAATTATTATCAAATACTAATTTGACAAATTTATATCATTTATTACCCATTGTAAGTATTGATATTGAAACAATAACTGATAATTTGAATGATCTGCCGTTGGGTATTAATGAAAATGAACAAATATCATCGTTGGTATTGTTTTGTAGATATTTAGATTCAATATTAATATATGCGATATACCAATCCATTCCATTGTATACTATGGACAATGGTGATAGTACAACTATTAAAATTGATAATAATTATAACAACCGAATTTGGAAAGAAACTGATAAAAAGTTGGCCATGTATTTTCAAAAAAGATATTCTAATAAATATCCAAATTATCAAGTTAGAGTTATAGTTAAATCTTTTACAACTGAAGATGATTTATTAAATAATTTTTTTGCATATTACGCATCCGGTATTATATTTAAAAATTTCAACCTACCAACGGATTCGTATCATATTTTGACCGGTTATAATATTTATAATTATGATTTGCCAACAATTTACAATCGTTTGTTGTGGTATCAAAAAAATGAAAAGTGTATAAATAGCGGATTATTAGAAATTAAAGGACAAAAGAATGGATGCCCTAATTTTAATAATCATGCAATTATAATAGACATGTATTTATTATTTGGAAGTAATCATTTATTTACCGGCGGTCGATCATTAAAAGAAGTATCGAAATCATTAATAAAACACGACACCAAGATTGATTTAAATGCCGTTGCTATACGTATTCCGTATATGTATGAGAAATATTTGAAAAAAAAATCATCTCAAGATGATATAAATAAAAATATATCTATTGTACAAACATTTATTGATTTTTTAAAGAAATTCATAGACATTCCAGACATTAACAATACAAAATCGGATTTATCGGATAACAATTTATTAGATGCAAATTCTAGCATTTTTATTGATATGATTGATTTTCCAAATGATTTGAAAAATAAAATAACAAATTCAACGCATGTAAATAAAATCCAATTGCCAAAATTATTTACTACACTTCATTATAACATATGCGATTGTGAATGTATACTAACACTTCAAGATTTTATTGGTTTATTTCCATTGTTAACTGATTTAATGTGTAAATTTCCGAATAATATTGAAAATTGCATTCAGGATAATATAACAAATCGTATGAATTCGTTTTTTAGTATCGAAGCAATTAAATGTCTACAATTATACTGTCAAAGCGGTAACGAAAGAAATACAGAATTTTACGAATTATTTATTGAAAATCCAATTTCAAAACAACTCATAAATACGCTTTATCAACATATAAAAACTACAACAAATACATTATTTGATGTAGAATCGCAAGTTAATAATTATTGTGATAATGATAATGACAATCAAGATGATGATGAAAAAGATATTAATAGTCATTCAAATAATCAAGAATTATTACCAATAAATAATAATCCATTAAATGAATTAAAAAACATATTAACTGTTAACGCAGTGCACGTTGATATATATATGTATTCTACTAGAGCGGCATATAAAGGTGCAGTCACTGGTAATAAACCAGGCATATACGAATTAAATTATAATTTAGATGCGACATCATTATATCCAACTATTGAAAGCGATGGAAAATTATATGTAGACTCTACAGACTTTATAAGTGTTGGAGCTTTAAAAAAAATATGTAATGATAATACGCATTTTAAATTTATATTCAATACATTAATAAAAAATTGTGATTTAAAAATTATGCTTTGTGAAGATGTTGATTTTAAAAAAATACAAATATTAGATACTGAATTGTTAAATTCCAATAGTATAACTACAAGACAAAAGAGAAAAGTAATAAATGTTGATTATGTAAATGAATTTTTAAATAATTATAAAATCGATTATGAATTTAATACGACTATGAATTTTATAGGTCAATTAATAACAGACGTCAATCAACTTGATAGAATACCTCCTAAATTAGGTTTGATAATTGTAAGTAGGGATTCAAATTCTTTTTTGCCCAAGCTAATTAATAAAATTAAATTAAAACGAGCATCAATAAAATGCGAATTGAAAAAGATAATTAATGAGGATAGAAAAAAAAAATTAAACGGTGAACAACAATCGTTAAAAATTATAATCAACAGTCTATATGGTTTATTTGCTAATAGTAATATTCCTGTTGCCGCGGGTACAACTTTGTACGGCAGAAAAATTATCATATGTAGTTTAAAATATTTTTTCTCTTTATACTTACACATTTGTTGTTGTTTACAGACCATGTTTGAAGAACATTATAATAATTCGTATGATCGTATACTTAATGAAAGTTCTATTACGAACGGTGTAATTCCTAATGATGTATTATTTAAATATAAATTATTCAATTATCCCAATTCTACTATTGATATTTGTAACTCTTTAAGACGTATGAATGATTTAAATATTAATCTAAAACCTTTTGACAATTATTTCAATATGATGATGTTAAGAGCGCAATGTGATGGCTTTGATGATGTTAAGATATTTAAAGAAGTTATTGGCGTTATTGAATCATCTCAATTAGATTTACATACGTTTGTTAATACTCAATTGCCCAAAAAATGCCATGACATCATTGTTGATTTTGATACTGACGGATTTCAAATATCAAATATTGCCAAATTATCAACAACCTACTTAAGATCGACATTCAACGAAAGCATACGTAAAACATTTAATATGCCTAATTTAAATTTTGAATCAAAACATAATTTAATATTAATTAGTATGAAAAAAAAAAAATACTGTCAACTATTGTCTGGAATAGTCATTGAAAATAATAAAGAAAGCTATGATTTTTATAAAAATAATCATAATCCGGTGTTATTATCAGAAATGAAAATTGCTCACAGTGGATATGAAAGAAATGCAGTACCGATAATTAAATATATTTGTGATGTTTTAGCAGTTAAAACATTTCTTAATTATCGCTACAAGTATTTTAATGTTCCATTTTCGTATATTCTCGAGGGCATTTATACGTACATATATATGCGTAAAGATCCTTATGATTTATTTATTAATATAGCATTGAAAAAAATTAAACCCAATTCATCTAGAAAAAGATTTATTGATCGACATGCAACTAATTATACTGGAACTTTAAAATCGGTATATATTGTCAACAATGAAGATTTTGAAGATGAATTTTTAATGTTACACGATGATTATTTAAGATCTAAAGATAACCTGAAATTACATTATGCTTATTTTTTTCGACAATATATTAAAGTTTGGTTTACTCAATTACAACACGCCGGTGTTTATTTGAATAACAATACTAGTAATAATAGTGTCCGCAATAGCAGCAATAACAATACAAATATTAATGAAACTAATTTACAAAAATATCAATTACAAGCATTTAAACAATGGTTGCATTTAATAAATAATAATAATAATATTTTTTTAGAAAATGTAATTTATAAAGATTTAATTTCAAAATCTGTATATATTCATTGA




we need to format our sequence file into an MMseqs2 database:

```bash
mmseqs createdb example.fasta exampleDB
```

## Running a Sequence Search

To search a query sequence against the database:

```bash
mmseqs search query.fasta exampleDB resultDB tmp
mmseqs convertalis query.fasta exampleDB resultDB result.tsv
```

This will generate a results file (`result.tsv`) containing hits.

## Interpreting Results in R

We can analyze the results in R:

```{r}
library(tidyverse)

# Load results
df <- read_tsv("result.tsv", col_names = c("query", "target", "evalue", "bit_score"))

# Inspect the top hits
head(df)

# Plot bit score distribution
ggplot(df, aes(x = bit_score)) +
  geom_histogram(binwidth = 5, fill = "blue", alpha = 0.7) +
  theme_minimal() +
  labs(title = "Distribution of Bit Scores", x = "Bit Score", y = "Count")
```

## Conclusion

MMseqs2 is a powerful alternative to BLAST that allows rapid sequence similarity searches. This workshop demonstrated how to set up MMseqs2, create a database, perform searches, and analyze results using R.
